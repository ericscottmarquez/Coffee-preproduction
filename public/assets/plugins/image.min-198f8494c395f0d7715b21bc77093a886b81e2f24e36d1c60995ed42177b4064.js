/*!
 * froala_editor v2.8.5 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2018 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,a){return a===undefined&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(a)}:e(window.jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),e.extend(e.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5}),e.FE.PLUGINS.image=function(t){function a(){var e=t.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),ie&&e.val(ie.attr("src")),e.trigger("change")}function i(){var e=t.popups.get("image.edit");if(e||(e=c()),e){var a=te();ae()&&(a=a.find(".fr-img-wrap")),t.popups.setContainer("image.edit",t.$sc),t.popups.refresh("image.edit");var i=a.offset().left+a.outerWidth()/2,r=a.offset().top+a.outerHeight();t.popups.show("image.edit",i,r,a.outerHeight())}}function r(){h()}function s(){for(var a,i,r="IMG"==t.el.tagName?[t.el]:t.el.querySelectorAll("img"),s=0;s<r.length;s++){var n=e(r[s]);!t.opts.htmlUntouched&&t.opts.useClasses?((t.opts.imageDefaultAlign||t.opts.imageDefaultDisplay)&&(0<(i=n).parents(".fr-img-caption").length&&(i=i.parents(".fr-img-caption:first")),i.hasClass("fr-dii")||i.hasClass("fr-dib")||(i.addClass("fr-fi"+V(i)[0]),i.addClass("fr-di"+Q(i)[0]),i.css("margin",""),i.css("float",""),i.css("display",""),i.css("z-index",""),i.css("position",""),i.css("overflow",""),i.css("vertical-align",""))),t.opts.imageTextNear||(0<n.parents(".fr-img-caption").length?n.parents(".fr-img-caption:first").removeClass("fr-dii").addClass("fr-dib"):n.removeClass("fr-dii").addClass("fr-dib"))):t.opts.htmlUntouched||t.opts.useClasses||(t.opts.imageDefaultAlign||t.opts.imageDefaultDisplay)&&(0<(a=n).parents(".fr-img-caption").length&&(a=a.parents(".fr-img-caption:first")),q(a,a.hasClass("fr-dib")?"block":a.hasClass("fr-dii")?"inline":null,a.hasClass("fr-fil")?"left":a.hasClass("fr-fir")?"right":V(a)),a.removeClass("fr-dib fr-dii fr-fir fr-fil")),t.opts.iframe&&n.on("load",t.size.syncIframe)}}function n(a){void 0===a&&(a=!0);var i,r=Array.prototype.slice.call(t.el.querySelectorAll("img")),s=[];for(i=0;i<r.length;i++)if(s.push(r[i].getAttribute("src")),e(r[i]).toggleClass("fr-draggable",t.opts.imageMove),""===r[i].getAttribute("class")&&r[i].removeAttribute("class"),""===r[i].getAttribute("style")&&r[i].removeAttribute("style"),r[i].parentNode&&r[i].parentNode.parentNode&&t.node.hasClass(r[i].parentNode.parentNode,"fr-img-caption")){var n=r[i].parentNode.parentNode;t.browser.mozilla||t.browser.msie||n.setAttribute("contenteditable",!1),n.setAttribute("draggable",!1),n.classList.add("fr-draggable");var o=r[i].nextSibling;o&&o.setAttribute("contenteditable",!0)}if(oe)for(i=0;i<oe.length;i++)s.indexOf(oe[i].getAttribute("src"))<0&&t.events.trigger("image.removed",[e(oe[i])]);if(oe&&a){var l=[];for(i=0;i<oe.length;i++)l.push(oe[i].getAttribute("src"));for(i=0;i<r.length;i++)l.indexOf(r[i].getAttribute("src"))<0&&t.events.trigger("image.loaded",[e(r[i])])}oe=r}function o(){if(re||function(){var a;if(t.shared.$image_resizer?(re=t.shared.$image_resizer,ne=t.shared.$img_overlay,t.events.on("destroy",function(){re.removeClass("fr-active").appendTo(e("body:first"))},!0)):(t.shared.$image_resizer=e('<div class="fr-image-resizer"></div>'),re=t.shared.$image_resizer,t.events.$on(re,"mousedown",function(e){e.stopPropagation()},!0),t.opts.imageResize&&(re.append(l("nw")+l("ne")+l("sw")+l("se")),t.shared.$img_overlay=e('<div class="fr-image-overlay"></div>'),ne=t.shared.$img_overlay,a=re.get(0).ownerDocument,e(a).find("body:first").append(ne))),t.events.on("shared.destroy",function(){re.html("").removeData().remove(),re=null,t.opts.imageResize&&(ne.remove(),ne=null)},!0),t.helpers.isMobile()||t.events.$on(e(t.o_win),"resize",function(){ie&&!ie.hasClass("fr-uploading")?X(!0):ie&&(o(),J(),m(!1))}),t.opts.imageResize){a=re.get(0).ownerDocument,t.events.$on(re,t._mousedown,".fr-handler",p),t.events.$on(e(a),t._mousemove,g),t.events.$on(e(a.defaultView||a.parentWindow),t._mouseup,d),t.events.$on(ne,"mouseleave",d);var i=1,r=null,s=0;t.events.on("keydown",function(a){if(ie){var n=-1!=navigator.userAgent.indexOf("Mac OS X")?a.metaKey:a.ctrlKey,o=a.which;(o!==r||200<a.timeStamp-s)&&(i=1),(o==e.FE.KEYCODE.EQUALS||t.browser.mozilla&&o==e.FE.KEYCODE.FF_EQUALS)&&n&&!a.altKey?i=N.call(this,a,1,1,i):(o==e.FE.KEYCODE.HYPHEN||t.browser.mozilla&&o==e.FE.KEYCODE.FF_HYPHEN)&&n&&!a.altKey?i=N.call(this,a,2,-1,i):t.keys.ctrlKey(a)||o!=e.FE.KEYCODE.ENTER||(ie.before("<br>"),b(ie)),r=o,s=a.timeStamp}},!0),t.events.on("keyup",function(){i=1})}}(),!ie)return!1;var a=t.$wp||t.$sc;a.append(re),re.data("instance",t);var i=a.scrollTop()-("static"!=a.css("position")?a.offset().top:0),r=a.scrollLeft()-("static"!=a.css("position")?a.offset().left:0);r-=t.helpers.getPX(a.css("border-left-width")),i-=t.helpers.getPX(a.css("border-top-width")),t.$el.is("img")&&t.$sc.is("body")&&(r=i=0);var s=te();ae()&&(s=s.find(".fr-img-wrap")),re.css("top",(t.opts.iframe?s.offset().top:s.offset().top+i)-1).css("left",(t.opts.iframe?s.offset().left:s.offset().left+r)-1).css("width",s.get(0).getBoundingClientRect().width).css("height",s.get(0).getBoundingClientRect().height).addClass("fr-active")}function l(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function f(e){ae()?ie.parents(".fr-img-caption").css("width",e):ie.css("width",e)}function p(a){if(!t.core.sameInstance(re))return!0;if(a.preventDefault(),a.stopPropagation(),t.$el.find("img.fr-error").left)return!1;t.undo.canDo()||t.undo.saveStep();var i=a.pageX||a.originalEvent.touches[0].pageX;if("mousedown"==a.type){var r=t.$oel.get(0).ownerDocument,s=r.defaultView||r.parentWindow,n=!1;try{n=s.location!=s.parent.location&&!(s.$&&s.$.FE)}catch(oe){}n&&s.frameElement&&(i+=t.helpers.getPX(e(s.frameElement).offset().left)+s.frameElement.clientLeft)}(se=e(this)).data("start-x",i),se.data("start-width",ie.width()),se.data("start-height",ie.height());var o=ie.width();if(t.opts.imageResizeWithPercent){var l=ie.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.el;o=(o/e(l).outerWidth()*100).toFixed(2)+"%"}f(o),ne.show(),t.popups.hideAll(),G()}function g(a){if(!t.core.sameInstance(re))return!0;var i;if(se&&ie){if(a.preventDefault(),t.$el.find("img.fr-error").left)return!1;var r=a.pageX||(a.originalEvent.touches?a.originalEvent.touches[0].pageX:null);if(!r)return!1;var s=r-se.data("start-x"),n=se.data("start-width");if((se.hasClass("fr-hnw")||se.hasClass("fr-hsw"))&&(s=0-s),t.opts.imageResizeWithPercent){var l=ie.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.el;n=((n+s)/e(l).outerWidth()*100).toFixed(2),t.opts.imageRoundPercent&&(n=Math.round(n)),f(n+"%"),(i=ae()?(t.helpers.getPX(ie.parents(".fr-img-caption").css("width"))/e(l).outerWidth()*100).toFixed(2):(t.helpers.getPX(ie.css("width"))/e(l).outerWidth()*100).toFixed(2))===n||t.opts.imageRoundPercent||f(i+"%"),ie.css("height","").removeAttr("height")}else n+s>=t.opts.imageMinWidth&&(f(n+s),i=ae()?t.helpers.getPX(ie.parents(".fr-img-caption").css("width")):t.helpers.getPX(ie.css("width"))),i!==n+s&&f(i),((ie.attr("style")||"").match(/(^height:)|(; *height:)/)||ie.attr("height"))&&(ie.css("height",se.data("start-height")*ie.width()/se.data("start-width")),ie.removeAttr("height"));o(),t.events.trigger("image.resize",[ee()])}}function d(e){if(!t.core.sameInstance(re))return!0;if(se&&ie){if(e&&e.stopPropagation(),t.$el.find("img.fr-error").left)return!1;se=null,ne.hide(),o(),i(),t.undo.saveStep(),t.events.trigger("image.resizeEnd",[ee()])}}function u(e,a,i){t.edit.on(),ie&&ie.addClass("fr-error"),function(e){m();var a=t.popups.get("image.insert").find(".fr-image-progress-bar-layer");a.addClass("fr-error");var i=a.find("h3");i.text(e),t.events.disableBlur(),i.focus()}(t.language.translate("Something went wrong. Please try again.")),!ie&&i&&T(i),t.events.trigger("image.error",[{code:e,message:be[e]},a,i])}function c(e){if(e)return t.$wp&&t.events.$on(t.$wp,"scroll",function(){ie&&t.popups.isVisible("image.edit")&&(t.events.disableBlur(),b(ie))}),!0;var a="";if(0<t.opts.imageEditButtons.length){a+='<div class="fr-buttons">',a+=t.button.buildList(t.opts.imageEditButtons);var i={buttons:a+="</div>"};return t.popups.create("image.edit",i)}return!1}function m(e){var a=t.popups.get("image.insert");if(a||(a=$()),a.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),a.find(".fr-image-progress-bar-layer").addClass("fr-active"),a.find(".fr-buttons").hide(),ie){var i=te();t.popups.setContainer("image.insert",t.$sc);var r=i.offset().left+i.width()/2,s=i.offset().top+i.height();t.popups.show("image.insert",r,s,i.outerHeight())}void 0===e&&v(t.language.translate("Uploading"),0)}function h(e){var a=t.popups.get("image.insert");if(a&&(a.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),a.find(".fr-image-progress-bar-layer").removeClass("fr-active"),a.find(".fr-buttons").show(),e||t.$el.find("img.fr-error").length)){if(t.events.focus(),t.$el.find("img.fr-error").length&&(t.$el.find("img.fr-error").remove(),t.undo.saveStep(),t.undo.run(),t.undo.dropRedo()),!t.$wp&&ie){var i=ie;X(!0),t.selection.setAfter(i.get(0)),t.selection.restore()}t.popups.hide("image.insert")}}function v(e,a){var i=t.popups.get("image.insert");if(i){var r=i.find(".fr-image-progress-bar-layer");r.find("h3").text(e+(a?" "+a+"%":"")),r.removeClass("fr-error"),a?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",a+"%")):r.find("div").addClass("fr-indeterminate")}}function b(e){Y.call(e.get(0))}function y(){var a=e(this);t.popups.hide("image.insert"),a.removeClass("fr-uploading"),a.next().is("br")&&a.next().remove(),b(a),t.events.trigger("image.loaded",[a])}function w(e,a,i,r,s){t.edit.off(),v(t.language.translate("Loading image")),a&&(e=t.helpers.sanitizeURL(e));var o=new Image;o.onload=function(){var a,o;if(r){t.undo.canDo()||r.hasClass("fr-uploading")||t.undo.saveStep();var l=r.data("fr-old-src");r.data("fr-image-pasted")&&(l=null),t.$wp?((a=r.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),l&&r.attr("src",l),r.replaceWith(a)):a=r;for(var f=a.get(0).attributes,p=0;p<f.length;p++){var g=f[p];0===g.nodeName.indexOf("data-")&&a.removeAttr(g.nodeName)}if(void 0!==i)for(o in i)i.hasOwnProperty(o)&&"link"!=o&&a.attr("data-"+o,i[o]);a.on("load",y),a.attr("src",e),t.edit.on(),n(!1),t.undo.saveStep(),t.events.disableBlur(),t.$el.blur(),t.events.trigger(l?"image.replaced":"image.inserted",[a,s])}else a=R(e,i,y),n(!1),t.undo.saveStep(),t.events.disableBlur(),t.$el.blur(),t.events.trigger("image.inserted",[a,s])},o.onerror=function(){u(ge)},m(t.language.translate("Loading image")),o.src=e}function E(a){v(t.language.translate("Loading image"));var i=this.status,r=this.response,s=this.responseXML,n=this.responseText;try{if(t.opts.imageUploadToS3)if(201==i){var o=function(a){try{var i=e(a).find("Location").text(),r=e(a).find("Key").text();return!1===t.events.trigger("image.uploadedToS3",[i,r,a],!0)?(t.edit.on(),!1):i}catch(s){return u(ce,a),!1}}(s);o&&w(o,!1,[],a,r||s)}else u(ce,r||s,a);else if(200<=i&&i<300){var l=function(e){try{if(!1===t.events.trigger("image.uploaded",[e],!0))return t.edit.on(),!1;var a=JSON.parse(e);return a.link?a:(u(de,e),!1)}catch(r){return u(ce,e),!1}}(n);l&&w(l.link,!1,l,a,r||n)}else u(ue,r||n,a)}catch(oe){u(ce,r||n,a)}}function C(){u(ce,this.response||this.responseText||this.responseXML)}function A(e){if(e.lengthComputable){var a=e.loaded/e.total*100|0;v(t.language.translate("Uploading"),a)}}function R(a,i,r){var s,n="";if(i&&void 0!==i)for(s in i)i.hasOwnProperty(s)&&"link"!=s&&(n+=" data-"+s+'="'+i[s]+'"');var o=t.opts.imageDefaultWidth;o&&"auto"!=o&&(o+=t.opts.imageResizeWithPercent?"%":"px");var l=e('<img src="'+a+'"'+n+(o?' style="width: '+o+';"':"")+">");q(l,t.opts.imageDefaultDisplay,t.opts.imageDefaultAlign),l.on("load",r),l.on("error",function(){e(this).addClass("fr-error"),u(ve)}),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.undo.saveStep(),t.opts.imageSplitHTML?t.markers.split():t.markers.insert(),t.html.wrap();var f=t.$el.find(".fr-marker");return f.length?(f.parent().is("hr")&&f.parent().after(f),t.node.isLastSibling(f)&&f.parent().hasClass("fr-deletable")&&f.insertAfter(f.parent()),f.replaceWith(l)):t.$el.append(l),t.selection.clear(),l}function S(){t.edit.on(),h(!0)}function D(a,i){if(void 0!==a&&0<a.length){if(!1===t.events.trigger("image.beforeUpload",[a,i]))return!1;var r,s=a[0];if((null===t.opts.imageUploadURL||t.opts.imageUploadURL==fe)&&!t.opts.imageUploadToS3)return f=s,p=i||ie,(g=new FileReader).addEventListener("load",function(){var e=g.result;if(g.result.indexOf("svg+xml")<0){for(var a=atob(g.result.split(",")[1]),i=[],r=0;r<a.length;r++)i.push(a.charCodeAt(r));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:f.type})),t.image.insert(e,!1,null,p)}},!1),m(),g.readAsDataURL(f),!1;if(s.name||(s.name=(new Date).getTime()+"."+(s.type||"image/jpeg").replace(/image\//g,"")),s.size>t.opts.imageMaxSize)return u(me),!1;if(t.opts.imageAllowedTypes.indexOf(s.type.replace(/image\//g,""))<0)return u(he),!1;if(t.drag_support.formdata&&(r=t.drag_support.formdata?new FormData:null),r){var n;if(!1!==t.opts.imageUploadToS3)for(n in r.append("key",t.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(s.name||"untitled")),r.append("success_action_status","201"),r.append("X-Requested-With","xhr"),r.append("Content-Type",s.type),t.opts.imageUploadToS3.params)t.opts.imageUploadToS3.params.hasOwnProperty(n)&&r.append(n,t.opts.imageUploadToS3.params[n]);for(n in t.opts.imageUploadParams)t.opts.imageUploadParams.hasOwnProperty(n)&&r.append(n,t.opts.imageUploadParams[n]);r.append(t.opts.imageUploadParam,s,s.name);var l=t.opts.imageUploadURL;t.opts.imageUploadToS3&&(l=t.opts.imageUploadToS3.uploadURL?t.opts.imageUploadToS3.uploadURL:"https://"+t.opts.imageUploadToS3.region+".amazonaws.com/"+t.opts.imageUploadToS3.bucket),function(a,i,r,s){function n(){var r=e(this);r.off("load"),r.addClass("fr-uploading"),r.next().is("br")&&r.next().remove(),t.placeholder.refresh(),b(r),o(),m(),t.edit.off(),a.onload=function(){E.call(a,r)},a.onerror=C,a.upload.onprogress=A,a.onabort=S,r.off("abortUpload").on("abortUpload",function(){4!=a.readyState&&a.abort()}),a.send(i)}var l=new FileReader;l.addEventListener("load",function(){var e=l.result;if(l.result.indexOf("svg+xml")<0){for(var a=atob(l.result.split(",")[1]),i=[],r=0;r<a.length;r++)i.push(a.charCodeAt(r));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:"image/jpeg"}))}s?(s.on("load",n),s.one("error",function(){s.off("load"),s.attr("src",s.data("fr-old-src")),u(ve)}),t.edit.on(),t.undo.saveStep(),s.data("fr-old-src",s.attr("src")),s.attr("src",e)):R(e,null,n)},!1),l.readAsDataURL(r)}(t.core.getXHR(l,t.opts.imageUploadMethod),r,s,i||ie)}}var f,p,g}function x(e){if(e.is("img")&&0<e.parents(".fr-img-caption").length)return e.parents(".fr-img-caption")}function U(a){var i=a.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&-1!==r.type.indexOf("image")&&0<=t.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))){if(!t.opts.imageUpload)return a.preventDefault(),a.stopPropagation(),!1;t.markers.remove(),t.markers.insertAtPoint(a.originalEvent),t.$el.find(".fr-marker").replaceWith(e.FE.MARKERS),0===t.$el.find(".fr-marker").length&&t.selection.setAtEnd(t.el),t.popups.hideAll();var s=t.popups.get("image.insert");s||(s=$()),t.popups.setContainer("image.insert",t.$sc);var n=a.originalEvent.pageX,o=a.originalEvent.pageY;return t.opts.iframe&&(o+=t.$iframe.offset().top,n+=t.$iframe.offset().left),t.popups.show("image.insert",n,o),m(),0<=t.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))?(X(!0),D(i.files)):u(he),a.preventDefault(),a.stopPropagation(),!1}}}function $(i){if(i)return t.popups.onRefresh("image.insert",a),t.popups.onHide("image.insert",r),!0;var s,n="";t.opts.imageUpload||t.opts.imageInsertButtons.splice(t.opts.imageInsertButtons.indexOf("imageUpload"),1),1<t.opts.imageInsertButtons.length&&(n='<div class="fr-buttons">'+t.button.buildList(t.opts.imageInsertButtons)+"</div>");var o=t.opts.imageInsertButtons.indexOf("imageUpload"),l=t.opts.imageInsertButtons.indexOf("imageByURL"),f="";0<=o&&(s=" fr-active",0<=l&&l<o&&(s=""),f='<div class="fr-image-upload-layer'+s+' fr-layer" id="fr-image-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop image")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+t.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-'+t.id+'" role="button"></div></div>');var p="";0<=l&&(s=" fr-active",0<=o&&o<l&&(s=""),p='<div class="fr-image-by-url-layer'+s+' fr-layer" id="fr-image-by-url-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-'+t.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">'+t.language.translate("Insert")+"</button></div></div>");var g,d={buttons:n,upload_layer:f,by_url_layer:p,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'},u=t.popups.create("image.insert",d);return t.$wp&&t.events.$on(t.$wp,"scroll",function(){ie&&t.popups.isVisible("image.insert")&&J()}),g=u,t.events.$on(g,"dragover dragenter",".fr-image-upload-layer",function(){return e(this).addClass("fr-drop"),!1},!0),t.events.$on(g,"dragleave dragend",".fr-image-upload-layer",function(){return e(this).removeClass("fr-drop"),!1},!0),t.events.$on(g,"drop",".fr-image-upload-layer",function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("fr-drop");var i=a.originalEvent.dataTransfer;if(i&&i.files){var r=g.data("instance")||t;r.events.disableBlur(),r.image.upload(i.files),r.events.enableBlur()}},!0),t.helpers.isIOS()&&t.events.$on(g,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){e(this).trigger("click")},!0),t.events.$on(g,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var a=g.data("instance")||t;a.events.disableBlur(),g.find("input:focus").blur(),a.events.enableBlur(),a.image.upload(this.files,ie)}e(this).val("")},!0),u}function I(){ie&&t.popups.get("image.alt").find("input").val(ie.attr("alt")||"").trigger("change")}function F(){var e=t.popups.get("image.alt");e||(e=k()),h(),t.popups.refresh("image.alt"),t.popups.setContainer("image.alt",t.$sc);var a=te();ae()&&(a=a.find(".fr-img-wrap"));var i=a.offset().left+a.outerWidth()/2,r=a.offset().top+a.outerHeight();t.popups.show("image.alt",i,r,a.outerHeight())}function k(e){if(e)return t.popups.onRefresh("image.alt",I),!0;var a={buttons:'<div class="fr-buttons">'+t.button.buildList(t.opts.imageAltButtons)+"</div>",alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("Alternative Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">'+t.language.translate("Update")+"</button></div></div>"},i=t.popups.create("image.alt",a);return t.$wp&&t.events.$on(t.$wp,"scroll.image-alt",function(){ie&&t.popups.isVisible("image.alt")&&F()}),i}function B(){if(ie){var e=t.popups.get("image.size");e.find('input[name="width"]').val(ie.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(ie.get(0).style.height).trigger("change")}}function O(){var e=t.popups.get("image.size");e||(e=P()),h(),t.popups.refresh("image.size"),t.popups.setContainer("image.size",t.$sc);var a=te();ae()&&(a=a.find(".fr-img-wrap"));var i=a.offset().left+a.outerWidth()/2,r=a.offset().top+a.outerHeight();t.popups.show("image.size",i,r,a.outerHeight())}function P(e){if(e)return t.popups.onRefresh("image.size",B),!0;var a={buttons:'<div class="fr-buttons">'+t.button.buildList(t.opts.imageSizeButtons)+"</div>",size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+t.id+'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-'+t.id+'" type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height'+t.id+'" type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">'+t.language.translate("Update")+"</button></div></div>"},i=t.popups.create("image.size",a);return t.$wp&&t.events.$on(t.$wp,"scroll.image-size",function(){ie&&t.popups.isVisible("image.size")&&O()}),i}function N(e,t,a,i){return e.pageX=t,p.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),g.call(this,e),d.call(this,e),++i}function T(a){(a=a||te())&&!1!==t.events.trigger("image.beforeRemove",[a])&&(t.popups.hideAll(),Z(),X(!0),t.undo.canDo()||t.undo.saveStep(),a.get(0)==t.el?a.removeAttr("src"):(a.get(0).parentNode&&"A"==a.get(0).parentNode.tagName?(t.selection.setBefore(a.get(0).parentNode)||t.selection.setAfter(a.get(0).parentNode)||a.parent().after(e.FE.MARKERS),e(a.get(0).parentNode).remove()):(t.selection.setBefore(a.get(0))||t.selection.setAfter(a.get(0))||a.after(e.FE.MARKERS),a.remove()),t.html.fillEmptyBlocks(),t.selection.restore()),t.undo.saveStep())}function L(a){var i=a.which;if(ie&&(i==e.FE.KEYCODE.BACKSPACE||i==e.FE.KEYCODE.DELETE))return a.preventDefault(),a.stopPropagation(),T(),!1;if(ie&&i==e.FE.KEYCODE.ESC){var r=ie;return X(!0),t.selection.setAfter(r.get(0)),t.selection.restore(),a.preventDefault(),!1}if(ie&&(i==e.FE.KEYCODE.ARROW_LEFT||i==e.FE.KEYCODE.ARROW_RIGHT)){var s=ie.get(0);return X(!0),i==e.FE.KEYCODE.ARROW_LEFT?t.selection.setBefore(s):t.selection.setAfter(s),t.selection.restore(),a.preventDefault(),!1}return ie&&i!=e.FE.KEYCODE.F10&&!t.keys.isBrowserAction(a)?(a.preventDefault(),a.stopPropagation(),!1):void 0}function M(e){if(e&&"IMG"==e.tagName){if(t.node.hasClass(e,"fr-uploading")||t.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):t.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&t.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var a=e.parentNode.parentNode;a.removeAttribute("contenteditable"),a.removeAttribute("draggable"),a.classList.remove("fr-draggable");var i=e.nextSibling;i&&i.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var r=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),s=0;s<r.length;s++)M(r[s])}function z(a){if(!1===t.events.trigger("image.beforePasteUpload",[a]))return!1;ie=e(a),o(),i(),J(),m(),ie.one("load",function(){o(),m()});for(var r=atob(e(a).attr("src").split(",")[1]),s=[],n=0;n<r.length;n++)s.push(r.charCodeAt(n));D([new Blob([new Uint8Array(s)],{type:e(a).attr("src").split(",")[0].replace(/data\:/g,"").replace(/;base64/g,"")})],ie)}function _(){t.opts.imagePaste?t.$el.find("img[data-fr-image-pasted]").each(function(a,i){if(t.opts.imagePasteProcess){var r=t.opts.imageDefaultWidth;r&&"auto"!=r&&(r+=t.opts.imageResizeWithPercent?"%":"px"),e(i).css("width",r).removeClass("fr-dii fr-dib fr-fir fr-fil"),q(e(i),t.opts.imageDefaultDisplay,t.opts.imageDefaultAlign)}if(0===i.src.indexOf("data:"))z(i);else if(0===i.src.indexOf("blob:")||0===i.src.indexOf("http")&&t.opts.imageUploadRemoteUrls&&t.opts.imageCORSProxy){var s=new Image;s.crossOrigin="Anonymous",s.onload=function(){var e=t.o_doc.createElement("CANVAS"),a=e.getContext("2d");e.height=this.naturalHeight,e.width=this.naturalWidth,a.drawImage(this,0,0),i.src=e.toDataURL("image/png"),z(i)},s.src=(0===i.src.indexOf("blob:")?"":t.opts.imageCORSProxy+"/")+i.src}else 0!==i.src.indexOf("http")||0===i.src.indexOf("https://mail.google.com/mail")?(t.selection.save(),e(i).remove(),t.selection.restore()):e(i).removeAttr("data-fr-image-pasted")}):t.$el.find("img[data-fr-image-pasted]").remove()}function W(e){var a=e.target.result,i=t.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=t.opts.imageResizeWithPercent?"%":"px"),t.undo.saveStep(),t.html.insert('<img data-fr-image-pasted="true" src="'+a+'"'+(i?' style="width: '+i+';"':"")+">");var r=t.$el.find('img[data-fr-image-pasted="true"]');r&&q(r,t.opts.imageDefaultDisplay,t.opts.imageDefaultAlign),t.events.trigger("paste.after")}function K(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=null;if(e.clipboardData.getData("text/rtf"))t=e.clipboardData.items[0].getAsFile();else for(var a=0;a<e.clipboardData.items.length&&!(t=e.clipboardData.items[a].getAsFile());a++);if(t)return i=t,(r=new FileReader).onload=W,r.readAsDataURL(i),!1}var i,r}function H(e){return e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function Y(a){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;if(a&&"touchend"==a.type&&le)return!0;if(a&&t.edit.isDisabled())return a.stopPropagation(),a.preventDefault(),!1;for(var r=0;r<e.FE.INSTANCES.length;r++)e.FE.INSTANCES[r]!=t&&e.FE.INSTANCES[r].events.trigger("image.hideResizer");t.toolbar.disable(),a&&(a.stopPropagation(),a.preventDefault()),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.opts.iframe&&t.size.syncIframe(),ie=e(this),Z(),o(),i(),t.browser.msie||t.selection.clear(),t.helpers.isIOS()&&(t.events.disableBlur(),t.$el.blur()),t.button.bulkRefresh(),t.events.trigger("video.hideResizer")}function X(e){ie&&(ye||!0===e)&&(t.toolbar.enable(),re.removeClass("fr-active"),t.popups.hide("image.edit"),ie=null,G(),se=null,ne&&ne.hide())}function j(){ye=!0}function G(){ye=!1}function q(e,a,i){!t.opts.htmlUntouched&&t.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),i&&e.addClass("fr-fi"+i[0]),a&&e.addClass("fr-di"+a[0])):"inline"==a?(e.css({display:"inline-block",verticalAlign:"bottom",margin:t.opts.imageDefaultMargin}),"center"==i?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - "+2*t.opts.imageDefaultMargin+"px)",textAlign:"center"}):"left"==i?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - "+t.opts.imageDefaultMargin+"px)",textAlign:"left"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - "+t.opts.imageDefaultMargin+"px)",textAlign:"right"})):"block"==a&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:t.opts.imageDefaultMargin+"px auto",textAlign:"center"}),"left"==i?e.css({marginLeft:0,textAlign:"left"}):"right"==i&&e.css({marginRight:0,textAlign:"right"}))}function V(e){if(void 0===e&&(e=te()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function Q(e){void 0===e&&(e=te());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function J(){var e=t.popups.get("image.insert");e||(e=$()),t.popups.isVisible("image.insert")||(h(),t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$sc));var a=te();ae()&&(a=a.find(".fr-img-wrap"));var i=a.offset().left+a.outerWidth()/2,r=a.offset().top+a.outerHeight();t.popups.show("image.insert",i,r,a.outerHeight(!0))}function Z(){if(ie){t.events.disableBlur(),t.selection.clear();var e=t.doc.createRange();e.selectNode(ie.get(0)),t.browser.msie&&e.collapse(!0),t.selection.get().addRange(e),t.events.enableBlur()}}function ee(){return ie}function te(){return ae()?ie.parents(".fr-img-caption:first"):ie}function ae(){return!!ie&&0<ie.parents(".fr-img-caption").length}var ie,re,se,ne,oe,le,fe="https://i.froala.com/upload",pe=!1,ge=1,de=2,ue=3,ce=4,me=5,he=6,ve=8,be={};be[ge]="Image cannot be loaded from the passed link.",be[de]="No link in upload response.",be[ue]="Error during file upload.",be[ce]="Parsing response failed.",be[me]="File is too large.",be[he]="Image file type is invalid.",be[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var ye=!(be[ve]="Image file is corrupted.");return{_init:function(){var a;t.events.$on(t.$el,t._mousedown,"IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(a){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;t.helpers.isMobile()||t.selection.clear(),pe=!0,t.popups.areVisible()&&t.events.disableBlur(),t.browser.msie&&(t.events.disableBlur(),t.$el.attr("contenteditable",!1)),t.draggable||"touchstart"==a.type||a.preventDefault(),a.stopPropagation()}),t.events.$on(t.$el,t._mouseup,"IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(a){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;pe&&(pe=!1,a.stopPropagation(),t.browser.msie&&(t.$el.attr("contenteditable",!0),t.events.enableBlur()))}),t.events.on("keyup",function(a){if(a.shiftKey&&""===t.selection.text().replace(/\n/g,"")&&t.keys.isArrow(a.which)){var i=t.selection.element(),r=t.selection.endElement();i&&"IMG"==i.tagName?b(e(i)):r&&"IMG"==r.tagName&&b(e(r))}},!0),t.events.on("drop",U),t.events.on("element.beforeDrop",x),t.events.on("mousedown window.mousedown",j),t.events.on("window.touchmove",G),t.events.on("mouseup window.mouseup",function(){if(ie)return X(),!1;G()}),t.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&X()}),t.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){X(!(pe=!1))}),t.events.on("modals.hide",function(){ie&&(Z(),t.selection.clear())}),"IMG"==t.el.tagName&&t.$el.addClass("fr-view"),t.events.$on(t.$el,t.helpers.isMobile()&&!t.helpers.isWindowsPhone()?"touchend":"click","IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',Y),t.helpers.isMobile()&&(t.events.$on(t.$el,"touchstart","IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(){le=!1}),t.events.$on(t.$el,"touchmove",function(){le=!0})),t.$wp?(t.events.on("window.keydown keydown",L,!0),t.events.on("keyup",function(t){if(ie&&t.which==e.FE.KEYCODE.ENTER)return!1},!0)):t.events.$on(t.$win,"keydown",L),t.events.on("toolbar.esc",function(){if(ie){if(t.$wp)t.events.disableBlur(),t.events.focus();else{var e=ie;X(!0),t.selection.setAfter(e.get(0)),t.selection.restore()}return!1}},!0),t.events.on("toolbar.focusEditor",function(){if(ie)return!1},!0),t.events.on("window.cut window.copy",function(a){if(ie&&t.popups.isVisible("image.edit")&&!t.popups.get("image.edit").find(":focus").length){var i=te();ae()?(i.before(e.FE.START_MARKER),i.after(e.FE.END_MARKER),t.selection.restore(),t.paste.saveCopiedText(i.get(0).outerHTML,i.text())):(Z(),
t.paste.saveCopiedText(ie.get(0).outerHTML,ie.attr("alt"))),"copy"==a.type?setTimeout(function(){b(ie)}):(X(!0),t.undo.saveStep(),setTimeout(function(){t.undo.saveStep()},0))}},!0),t.browser.msie&&t.events.on("keydown",function(a){if(!t.selection.isCollapsed()||!ie)return!0;var i=a.which;i==e.FE.KEYCODE.C&&t.keys.ctrlKey(a)?t.events.trigger("window.copy"):i==e.FE.KEYCODE.X&&t.keys.ctrlKey(a)&&t.events.trigger("window.cut")}),t.events.$on(e(t.o_win),"keydown",function(t){var a=t.which;if(ie&&a==e.FE.KEYCODE.BACKSPACE)return t.preventDefault(),!1}),t.events.$on(t.$win,"keydown",function(t){var a=t.which;ie&&ie.hasClass("fr-uploading")&&a==e.FE.KEYCODE.ESC&&ie.trigger("abortUpload")}),t.events.on("destroy",function(){ie&&ie.hasClass("fr-uploading")&&ie.trigger("abortUpload")}),t.events.on("paste.before",K),t.events.on("paste.beforeCleanup",H),t.events.on("paste.after",_),t.events.on("html.set",s),t.events.on("html.inserted",s),s(),t.events.on("destroy",function(){oe=[]}),t.events.on("html.processGet",M),t.opts.imageOutputSize&&t.events.on("html.beforeGet",function(){a=t.el.querySelectorAll("img");for(var i=0;i<a.length;i++){var r=a[i].style.width||e(a[i]).width(),s=a[i].style.height||e(a[i]).height();r&&a[i].setAttribute("width",(""+r).replace(/px/,"")),s&&a[i].setAttribute("height",(""+s).replace(/px/,""))}}),t.opts.iframe&&t.events.on("image.loaded",t.size.syncIframe),t.$wp&&(n(),t.events.on("contentChanged",n)),t.events.$on(e(t.o_win),"orientationchange.image",function(){setTimeout(function(){ie&&b(ie)},100)}),c(!0),$(!0),P(!0),k(!0),t.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return T(e),!1})},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertImage"]'),a=t.popups.get("image.insert");if(a||(a=$()),h(),!a.hasClass("fr-active"))if(t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$tb),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("image.insert",i,r,e.outerHeight())}else t.position.forSelection(a),t.popups.show("image.insert")},showLayer:function(e){var a,i,r=t.popups.get("image.insert");if(ie||t.opts.toolbarInline){if(ie){var s=te();ae()&&(s=s.find(".fr-img-wrap")),i=s.offset().top+s.outerHeight(),a=s.offset().left+s.outerWidth()/2}}else{var n=t.$tb.find('.fr-command[data-cmd="insertImage"]');a=n.offset().left+n.outerWidth()/2,i=n.offset().top+(t.opts.toolbarBottom?10:n.outerHeight()-10)}!ie&&t.opts.toolbarInline&&(i=r.offset().top-t.helpers.getPX(r.css("margin-top")),r.hasClass("fr-above")&&(i+=r.outerHeight())),r.find(".fr-layer").removeClass("fr-active"),r.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("image.insert",a,i,ie?ie.outerHeight():0),t.accessibility.focusPopup(r)},refreshUploadButton:function(e){t.popups.get("image.insert").find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){t.popups.get("image.insert").find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:D,insertByURL:function(){var e=t.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<e.val().length){m(),v(t.language.translate("Loading image"));var a=e.val();if(t.opts.imageUploadRemoteUrls&&t.opts.imageCORSProxy&&t.opts.imageUpload){var i=new XMLHttpRequest;i.onload=function(){200==this.status?D([new Blob([this.response],{type:this.response.type||"image/png"})],ie):u(ge)},i.onerror=function(){w(a,!0,[],ie)},i.open("GET",t.opts.imageCORSProxy+"/"+a,!0),i.responseType="blob",i.send()}else w(a,!0,[],ie);e.val(""),e.blur()}},align:function(e){var a=te();a.removeClass("fr-fir fr-fil"),!t.opts.htmlUntouched&&t.opts.useClasses?"left"==e?a.addClass("fr-fil"):"right"==e&&a.addClass("fr-fir"):q(a,Q(),e),Z(),o(),i(),t.selection.clear()},refreshAlign:function(e){ie&&e.find("> *:first").replaceWith(t.icon.create("image-align-"+V()))},refreshAlignOnShow:function(e,t){ie&&t.find('.fr-command[data-param1="'+V()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(e){var a=te();a.removeClass("fr-dii fr-dib"),!t.opts.htmlUntouched&&t.opts.useClasses?"inline"==e?a.addClass("fr-dii"):"block"==e&&a.addClass("fr-dib"):q(a,e,V()),Z(),o(),i(),t.selection.clear()},refreshDisplayOnShow:function(e,t){ie&&t.find('.fr-command[data-param1="'+Q()+'"]').addClass("fr-active").attr("aria-selected",!0)},replace:J,back:function(){ie?(t.events.disableBlur(),e(".fr-popup input:focus").blur(),b(ie)):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("image.insert"),t.toolbar.showInline())},get:ee,getEl:te,insert:w,showProgressBar:m,remove:T,hideProgressBar:h,applyStyle:function(e,a,i){if(void 0===a&&(a=t.opts.imageStyles),void 0===i&&(i=t.opts.imageMultipleStyles),!ie)return!1;var r=te();if(!i){var s=Object.keys(a);s.splice(s.indexOf(e),1),r.removeClass(s.join(" "))}"object"==typeof a[e]?(r.removeAttr("style"),r.css(a[e].style)):r.toggleClass(e),b(ie)},showAltPopup:F,showSizePopup:O,setAlt:function(e){if(ie){var a=t.popups.get("image.alt");ie.attr("alt",e||a.find("input").val()||""),a.find("input:focus").blur(),b(ie)}},setSize:function(e,a){if(ie){var i=t.popups.get("image.size");e=e||i.find('input[name="width"]').val()||"",a=a||i.find('input[name="height"]').val()||"";var r=/^[\d]+((px)|%)*$/g;ie.removeAttr("width").removeAttr("height"),e.match(r)?ie.css("width",e):ie.css("width",""),a.match(r)?ie.css("height",a):ie.css("height",""),ae()&&(ie.parent().removeAttr("width").removeAttr("height"),e.match(r)?ie.parent().css("width",e):ie.parent().css("width",""),a.match(r)?ie.parent().css("height",a):ie.parent().css("height","")),i&&i.find("input:focus").blur(),b(ie)}},toggleCaption:function(){var a;ie&&!ae()?((a=ie).parent().is("a")&&(a=ie.parent()),a.wrap("<span "+(t.browser.mozilla||t.browser.msie?"":'contenteditable="false"')+'class="fr-img-caption '+ie.attr("class")+'" style="'+(ie.attr("style")?ie.attr("style")+" ":"")+"width: "+ie.width()+'px;" draggable="false"></span>'),a.wrap('<span class="fr-img-wrap"></span>'),a.after('<span class="fr-inner" contenteditable="true">'+e.FE.START_MARKER+"Image caption"+e.FE.END_MARKER+"</span>"),ie.removeAttr("class").removeAttr("style").removeAttr("width"),X(!0),t.selection.restore()):(a=te(),ie.insertAfter(a),ie.attr("class",a.attr("class").replace("fr-img-caption","")).attr("style",a.attr("style")),a.remove(),b(ie))},hasCaption:ae,exitEdit:X,edit:b}},e.FE.DefineIcon("insertImage",{NAME:"image"}),e.FE.RegisterShortcut(e.FE.KEYCODE.P,"insertImage",null,"P"),e.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.FE.DefineIcon("imageUpload",{NAME:"upload"}),e.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.FE.DefineIcon("imageByURL",{NAME:"link"}),e.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.FE.DefineIcon("imageDisplay",{NAME:"star"}),e.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.FE.DefineIcon("image-align",{NAME:"align-left"}),e.FE.DefineIcon("image-align-left",{NAME:"align-left"}),e.FE.DefineIcon("image-align-right",{NAME:"align-right"}),e.FE.DefineIcon("image-align-center",{NAME:"align-justify"}),e.FE.DefineIcon("imageAlign",{NAME:"align-justify"}),e.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(a[i])+'">'+this.icon.create("image-align-"+i)+'<span class="fr-sr-only">'+this.language.translate(a[i])+"</span></a></li>");return t+"</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.FE.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt"}),e.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.FE.DefineIcon("imageRemove",{NAME:"trash"}),e.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.FE.DefineIcon("imageStyle",{NAME:"magic"}),e.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.imageStyles;for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];"object"==typeof i&&(i=i.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'+a+'">'+this.language.translate(i)+"</a></li>"}return e+"</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(t,a){var i=this.image.getEl();i&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=i.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.DefineIcon("imageAlt",{NAME:"info"}),e.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),e.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),e.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),e.FE.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt"}),e.FE.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});