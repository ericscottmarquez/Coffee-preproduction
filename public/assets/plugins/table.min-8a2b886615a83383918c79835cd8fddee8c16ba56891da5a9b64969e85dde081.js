/*!
 * froala_editor v2.8.5 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2018 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,a){return a===undefined&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(a)}:e(window.jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),e.extend(e.FE.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),e.FE.PLUGINS.table=function(t){function a(){var e=b();if(e){var a=t.popups.get("table.edit");if(a||(a=o()),a){t.popups.setContainer("table.edit",t.$sc);var l=R(e),s=(l.left+l.right)/2,n=l.bottom;t.popups.show("table.edit",s,n,l.bottom-l.top),t.edit.isDisabled()&&(1<j().length&&t.toolbar.disable(),t.$el.removeClass("fr-no-selection"),t.edit.on(),t.button.bulkRefresh(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell:last").get(0)),t.selection.restore())}}}function l(){var a,s,n,r,o=b();if(o){var i=t.popups.get("table.colors");i||(i=function(){var a="";0<t.opts.tableColorsButtons.length&&(a='<div class="fr-buttons fr-table-colors-buttons">'+t.button.buildList(t.opts.tableColorsButtons)+"</div>");var s="";t.opts.colorsHEXInput&&(s='<div class="fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'+t.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">'+t.language.translate("OK")+"</button></div></div>");var n,r={buttons:a,colors:function(){for(var e='<div class="fr-table-colors">',a=0;a<t.opts.tableColors.length;a++)0!==a&&a%t.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=t.opts.tableColors[a]?e+='<span class="fr-command" style="background: '+t.opts.tableColors[a]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+t.opts.tableColors[a]+'"><span class="fr-sr-only">'+t.language.translate("Color")+" "+t.opts.tableColors[a]+"&nbsp;&nbsp;&nbsp;</span></span>":e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+t.language.translate("Clear Formatting")+'">'+t.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+t.language.translate("Clear Formatting")+"</span></span>";return e+"</div>"}(),custom_color:s},o=t.popups.create("table.colors",r);return t.events.$on(t.$wp,"scroll.table-colors",function(){t.popups.isVisible("table.colors")&&l()}),n=o,t.events.on("popup.tab",function(a){var l=e(a.currentTarget);if(!t.popups.isVisible("table.colors")||!l.is("span"))return!0;var s=a.which,r=!0;if(e.FE.KEYCODE.TAB==s){var o=n.find(".fr-buttons");r=!t.accessibility.focusToolbar(o,!!a.shiftKey)}else if(e.FE.KEYCODE.ARROW_UP==s||e.FE.KEYCODE.ARROW_DOWN==s||e.FE.KEYCODE.ARROW_LEFT==s||e.FE.KEYCODE.ARROW_RIGHT==s){var i=l.parent().find("span.fr-command"),f=i.index(l),c=t.opts.colorsStep,d=Math.floor(i.length/c),p=f%c,h=Math.floor(f/c)*c+p,u=d*c;e.FE.KEYCODE.ARROW_UP==s?h=((h-c)%u+u)%u:e.FE.KEYCODE.ARROW_DOWN==s?h=(h+c)%u:e.FE.KEYCODE.ARROW_LEFT==s?h=((h-1)%u+u)%u:e.FE.KEYCODE.ARROW_RIGHT==s&&(h=(h+1)%u);var b=e(i.get(h));t.events.disableBlur(),b.focus(),r=!1}else e.FE.KEYCODE.ENTER==s&&(t.button.exec(l),r=!1);return!1===r&&(a.preventDefault(),a.stopPropagation()),r},!0),o}()),t.popups.setContainer("table.colors",t.$sc);var f=R(o),c=(f.left+f.right)/2,d=f.bottom;a=t.popups.get("table.colors"),s=t.$el.find(".fr-selected-cell:first"),n=t.helpers.RGBToHex(s.css("background-color")),r=a.find(".fr-table-colors-hex-layer input"),a.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),a.find('span[data-param1="'+n+'"]').addClass("fr-selected-color fr-active-item"),r.val(n).trigger("change"),t.popups.show("table.colors",c,d,f.bottom-f.top)}}function s(){0===j().length&&t.toolbar.enable()}function n(a){if(a)return t.popups.onHide("table.insert",function(){t.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseenter")}),!0;var l="";0<t.opts.tableInsertButtons.length&&(l='<div class="fr-buttons">'+t.button.buildList(t.opts.tableInsertButtons)+"</div>");var s,n={buttons:l,rows_columns:function(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',a=1;a<=t.opts.tableInsertMaxSize;a++){for(var l=1;l<=t.opts.tableInsertMaxSize;l++){var s="inline-block";2<a&&!t.helpers.isMobile()&&(s="none");var n="fr-table-cell ";1==a&&1==l&&(n+=" hover"),e+='<span class="fr-command '+n+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+a+'" data-col="'+l+'" data-param1="'+a+'" data-param2="'+l+'" style="display: '+s+';" role="button"><span></span><span class="fr-sr-only">'+a+" &times; "+l+"&nbsp;&nbsp;&nbsp;</span></span>"}e+='<div class="new-line"></div>'}return e+"</div></div>"}()},o=t.popups.create("table.insert",n);return t.events.$on(o,"mouseenter",".fr-table-size .fr-select-table-size .fr-table-cell",function(t){r(e(t.currentTarget))},!0),s=o,t.events.$on(s,"focus","[tabIndex]",function(t){r(e(t.currentTarget))}),t.events.on("popup.tab",function(a){var l=e(a.currentTarget);if(!t.popups.isVisible("table.insert")||!l.is("span, a"))return!0;var s,n=a.which;if(e.FE.KEYCODE.ARROW_UP==n||e.FE.KEYCODE.ARROW_DOWN==n||e.FE.KEYCODE.ARROW_LEFT==n||e.FE.KEYCODE.ARROW_RIGHT==n){if(l.is("span.fr-table-cell")){var o=l.parent().find("span.fr-table-cell"),i=o.index(l),f=t.opts.tableInsertMaxSize,c=i%f,d=Math.floor(i/f);e.FE.KEYCODE.ARROW_UP==n?d=Math.max(0,d-1):e.FE.KEYCODE.ARROW_DOWN==n?d=Math.min(t.opts.tableInsertMaxSize-1,d+1):e.FE.KEYCODE.ARROW_LEFT==n?c=Math.max(0,c-1):e.FE.KEYCODE.ARROW_RIGHT==n&&(c=Math.min(t.opts.tableInsertMaxSize-1,c+1));var p=d*f+c,h=e(o.get(p));r(h),t.events.disableBlur(),h.focus(),s=!1}}else e.FE.KEYCODE.ENTER==n&&(t.button.exec(l),s=!1);return!1===s&&(a.preventDefault(),a.stopPropagation()),s},!0),o}function r(e){var a=e.data("row"),l=e.data("col"),s=e.parent();s.siblings(".fr-table-size-info").html(a+" &times; "+l),s.find("> span").removeClass("hover fr-active-item");for(var n=1;n<=t.opts.tableInsertMaxSize;n++)for(var r=0;r<=t.opts.tableInsertMaxSize;r++){var o=s.find('> span[data-row="'+n+'"][data-col="'+r+'"]');n<=a&&r<=l?o.addClass("hover"):n<=a+1||n<=2&&!t.helpers.isMobile()?o.css("display","inline-block"):2<n&&!t.helpers.isMobile()&&o.css("display","none")}e.addClass("fr-active-item")}function o(e){if(e)return t.popups.onHide("table.edit",s),!0;if(0<t.opts.tableEditButtons.length){var l={buttons:'<div class="fr-buttons">'+t.button.buildList(t.opts.tableEditButtons)+"</div>"},n=t.popups.create("table.edit",l);return t.events.$on(t.$wp,"scroll.table-edit",function(){t.popups.isVisible("table.edit")&&a()}),n}return!1}function i(){if(0<j().length){var e=V();t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),t.selection.restore(),t.popups.hide("table.edit"),e.remove(),t.toolbar.enable()}}function f(l){var s=V();if(0<s.length){if(0<t.$el.find("th.fr-selected-cell").length&&"above"==l)return;var n,r,o,i=b(),f=C(i);r="above"==l?f.min_i:f.max_i;var c="<tr>";for(n=0;n<i[r].length;n++)if("below"==l&&r<i.length-1&&i[r][n]==i[r+1][n]||"above"==l&&0<r&&i[r][n]==i[r-1][n]){if(0===n||0<n&&i[r][n]!=i[r][n-1]){var d=e(i[r][n]);d.attr("rowspan",parseInt(d.attr("rowspan"),10)+1)}}else c+="<td><br></td>";c+="</tr>",o=0<t.$el.find("th.fr-selected-cell").length&&"below"==l?e(s.find("tbody").not(s.find("table tbody"))):e(s.find("tr").not(s.find("table tr")).get(r)),"below"==l?"TBODY"==o.prop("tagName")?o.prepend(c):o.after(c):"above"==l&&(o.before(c),t.popups.isVisible("table.edit")&&a())}}function c(e,t,a){var l,s,n,r,o,i=0,f=b(a);if(e<(t=Math.min(t,f[0].length-1)))for(s=e;s<=t;s++)if(!(e<s&&f[0][s]==f[0][s-1])&&1<(r=Math.min(parseInt(f[0][s].getAttribute("colspan"),10)||1,t-e+1))&&f[0][s]==f[0][s+1])for(i=r-1,l=1;l<f.length;l++)if(f[l][s]!=f[l-1][s]){for(n=s;n<s+r;n++)if(1<(o=parseInt(f[l][n].getAttribute("colspan"),10)||1)&&f[l][n]==f[l][n+1])n+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&p(f,i,"colspan",0,f.length-1,e,t)}function d(e,t,a){var l,s,n,r,o,i=0,f=b(a);if(e<(t=Math.min(t,f.length-1)))for(l=e;l<=t;l++)if(!(e<l&&f[l][0]==f[l-1][0])&&1<(r=Math.min(parseInt(f[l][0].getAttribute("rowspan"),10)||1,t-e+1))&&f[l][0]==f[l+1][0])for(i=r-1,s=1;s<f[0].length;s++)if(f[l][s]!=f[l][s-1]){for(n=l;n<l+r;n++)if(1<(o=parseInt(f[n][s].getAttribute("rowspan"),10)||1)&&f[n][s]==f[n+1][s])n+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&p(f,i,"rowspan",e,t,0,f[0].length-1)}function p(e,t,a,l,s,n,r){var o,i,f;for(o=l;o<=s;o++)for(i=n;i<=r;i++)l<o&&e[o][i]==e[o-1][i]||n<i&&e[o][i]==e[o][i-1]||1<(f=parseInt(e[o][i].getAttribute(a),10)||1)&&(1<f-t?e[o][i].setAttribute(a,f-t):e[o][i].removeAttribute(a))}function h(e,t,a,l,s){d(e,t,s),c(a,l,s)}function u(e){var l=t.$el.find(".fr-selected-cell");"REMOVE"!=e?l.css("background-color",t.helpers.HEXtoRGB(e)):l.css("background-color",""),a()}function b(t){var a=[];return null==(t=t||null)&&0<j().length&&(t=V()),t&&t.find("tr:visible").not(t.find("table tr")).each(function(t,l){var s=e(l),n=0;s.find("> th, > td").each(function(l,s){for(var r=e(s),o=parseInt(r.attr("colspan"),10)||1,i=parseInt(r.attr("rowspan"),10)||1,f=t;f<t+i;f++)for(var c=n;c<n+o;c++)a[f]||(a[f]=[]),a[f][c]?n++:a[f][c]=s;n+=o})}),a}function g(e,t){for(var a=0;a<t.length;a++)for(var l=0;l<t[a].length;l++)if(t[a][l]==e)return{row:a,col:l}}function m(e,t,a){for(var l=e+1,s=t+1;l<a.length;){if(a[l][t]!=a[e][t]){l--;break}l++}for(l==a.length&&l--;s<a[e].length;){if(a[e][s]!=a[e][t]){s--;break}s++}return s==a[e].length&&s--,{row:l,col:s}}function v(){t.el.querySelector(".fr-cell-fixed")&&t.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")&&t.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function w(){var a=t.$el.find(".fr-selected-cell");0<a.length&&a.each(function(){var t=e(this);t.removeClass("fr-selected-cell"),""===t.attr("class")&&t.removeAttr("class")}),v()}function E(){t.events.disableBlur(),t.selection.clear(),t.$el.addClass("fr-no-selection"),t.$el.blur(),t.events.enableBlur()}function C(e){var a=t.$el.find(".fr-selected-cell");if(0<a.length){var l,s=e.length,n=0,r=e[0].length,o=0;for(l=0;l<a.length;l++){var i=g(a[l],e),f=m(i.row,i.col,e);s=Math.min(i.row,s),n=Math.max(f.row,n),r=Math.min(i.col,r),o=Math.max(f.col,o)}return{min_i:s,max_i:n,min_j:r,max_j:o}}return null}function R(t){var a=C(t),l=e(t[a.min_i][a.min_j]),s=e(t[a.min_i][a.max_j]),n=e(t[a.max_i][a.min_j]);return{left:l.offset().left,right:s.offset().left+s.outerWidth(),top:l.offset().top,bottom:n.offset().top+n.outerHeight()}}function O(a,l){if(e(a).is(l))w(),e(a).addClass("fr-selected-cell");else{E(),t.edit.off();var s=b(),n=g(a,s),r=g(l,s),o=function c(t,a,l,s,n){var r,o,i,f,d=t,p=a,h=l,u=s;for(r=d;r<=p;r++)(1<(parseInt(e(n[r][h]).attr("rowspan"),10)||1)||1<(parseInt(e(n[r][h]).attr("colspan"),10)||1))&&(f=m((i=g(n[r][h],n)).row,i.col,n),d=Math.min(i.row,d),p=Math.max(f.row,p),h=Math.min(i.col,h),u=Math.max(f.col,u)),(1<(parseInt(e(n[r][u]).attr("rowspan"),10)||1)||1<(parseInt(e(n[r][u]).attr("colspan"),10)||1))&&(f=m((i=g(n[r][u],n)).row,i.col,n),d=Math.min(i.row,d),p=Math.max(f.row,p),h=Math.min(i.col,h),u=Math.max(f.col,u));for(o=h;o<=u;o++)(1<(parseInt(e(n[d][o]).attr("rowspan"),10)||1)||1<(parseInt(e(n[d][o]).attr("colspan"),10)||1))&&(f=m((i=g(n[d][o],n)).row,i.col,n),d=Math.min(i.row,d),p=Math.max(f.row,p),h=Math.min(i.col,h),u=Math.max(f.col,u)),(1<(parseInt(e(n[p][o]).attr("rowspan"),10)||1)||1<(parseInt(e(n[p][o]).attr("colspan"),10)||1))&&(f=m((i=g(n[p][o],n)).row,i.col,n),d=Math.min(i.row,d),p=Math.max(f.row,p),h=Math.min(i.col,h),u=Math.max(f.col,u));return d==t&&p==a&&h==l&&u==s?{min_i:t,max_i:a,min_j:l,max_j:s}:c(d,p,h,u,n)}(Math.min(n.row,r.row),Math.max(n.row,r.row),Math.min(n.col,r.col),Math.max(n.col,r.col),s);w(),a.classList.add("fr-cell-fixed"),l.classList.add("fr-cell-handler");for(var i=o.min_i;i<=o.max_i;i++)for(var f=o.min_j;f<=o.max_j;f++)e(s[i][f]).addClass("fr-selected-cell")}}function A(a){var l=null,s=e(a.target);return"TD"==a.target.tagName||"TH"==a.target.tagName?l=a.target:0<s.closest("td").length?l=s.closest("td").get(0):0<s.closest("th").length&&(l=s.closest("th").get(0)),0===t.$el.find(l).length?null:l}function F(){w(),t.popups.hide("table.edit")}function x(a){var l=A(a);if("false"==e(l).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;if(0<j().length&&!l&&F(),!t.edit.isDisabled()||t.popups.isVisible("table.edit"))if(1!=a.which||1==a.which&&t.helpers.isMac()&&a.ctrlKey)(3==a.which||1==a.which&&t.helpers.isMac()&&a.ctrlKey)&&l&&F();else if(G=!0,l){0<j().length&&!a.shiftKey&&F(),a.stopPropagation(),t.events.trigger("image.hideResizer"),t.events.trigger("video.hideResizer"),q=!0;var s=l.tagName.toLowerCase();a.shiftKey&&0<t.$el.find(s+".fr-selected-cell").length?e(t.$el.find(s+".fr-selected-cell").closest("table")).is(e(l).closest("table"))?O(J,l):E():((t.keys.ctrlKey(a)||a.shiftKey)&&(1<j().length||0===e(l).find(t.selection.element()).length&&!e(l).is(t.selection.element()))&&E(),J=l,0<t.opts.tableEditButtons.length&&O(J,J))}}function D(l){if(q||t.$tb.is(l.target)||t.$tb.is(e(l.target).closest(t.$tb.get(0)))||(0<j().length&&t.toolbar.enable(),w()),!(1!=l.which||1==l.which&&t.helpers.isMac()&&l.ctrlKey)&&(G=!1,q&&(q=!1,A(l)||1!=j().length?0<j().length&&(t.selection.isCollapsed()?a():w()):w()),Z)){Z=!1,X.removeClass("fr-moving"),t.$el.removeClass("fr-no-selection"),t.edit.on();var s=parseFloat(X.css("left"))+t.opts.tableResizerOffset+t.$wp.offset().left;t.opts.iframe&&(s-=t.$iframe.offset().left),X.data("release-position",s),X.removeData("max-left"),X.removeData("max-right"),function(){var a=X.data("origin"),l=X.data("release-position");if(a!==l){var s=X.data("first"),n=X.data("second"),r=X.data("table"),o=r.outerWidth();if(t.undo.canDo()||t.undo.saveStep(),null!==s&&null!==n){var i,f,c,d=b(r),p=[],h=[],u=[],g=[];for(i=0;i<d.length;i++)f=e(d[i][s]),c=e(d[i][n]),p[i]=f.outerWidth(),u[i]=c.outerWidth(),h[i]=p[i]/o*100,g[i]=u[i]/o*100;for(i=0;i<d.length;i++)if(f=e(d[i][s]),c=e(d[i][n]),d[i][s]!=d[i][n]){var m=(h[i]*(p[i]+l-a)/p[i]).toFixed(4);f.css("width",m+"%"),c.css("width",(h[i]+g[i]-m).toFixed(4)+"%")}}else{var v,w=r.parent(),E=o/w.width()*100,C=(parseInt(r.css("margin-left"),10)||0)/w.width()*100,R=(parseInt(r.css("margin-right"),10)||0)/w.width()*100;"rtl"==t.opts.direction&&0===n||"rtl"!=t.opts.direction&&0!==n?(v=(o+l-a)/o*E,r.css("margin-right","calc(100% - "+Math.round(v).toFixed(4)+"% - "+Math.round(C).toFixed(4)+"%)")):("rtl"==t.opts.direction&&0!==n||"rtl"!=t.opts.direction&&0===n)&&(v=(o-l+a)/o*E,r.css("margin-left","calc(100% - "+Math.round(v).toFixed(4)+"% - "+Math.round(R).toFixed(4)+"%)")),r.css("width",Math.round(v).toFixed(4)+"%")}t.selection.restore(),t.undo.saveStep(),t.events.trigger("table.resized",[r.get(0)])}X.removeData("origin"),X.removeData("release-position"),X.removeData("first"),X.removeData("second"),X.removeData("table")}(),I()}}function y(a){if(!0===q&&0<t.opts.tableEditButtons.length){if(e(a.currentTarget).closest("table").is(V())){if("TD"==a.currentTarget.tagName&&0===t.$el.find("th.fr-selected-cell").length)return void O(J,a.currentTarget);if("TH"==a.currentTarget.tagName&&0===t.$el.find("td.fr-selected-cell").length)return void O(J,a.currentTarget)}E()}}function $(a,l,s,n){for(var r,o=l;o!=t.el&&"TD"!=o.tagName&&"TH"!=o.tagName&&("up"==n?r=o.previousElementSibling:"down"==n&&(r=o.nextElementSibling),!r);)o=o.parentNode;"TD"==o.tagName||"TH"==o.tagName?function(a,l){for(var s=a;s&&"TABLE"!=s.tagName&&s.parentNode!=t.el;)s=s.parentNode;if(s&&"TABLE"==s.tagName){var n=b(e(s));"up"==l?M(g(a,n),s,n):"down"==l&&_(g(a,n),s,n)}}(o,n):r&&("up"==n&&t.selection.setAtEnd(r),"down"==n&&t.selection.setAtStart(r))}function M(e,a,l){0<e.row?t.selection.setAtEnd(l[e.row-1][e.col]):$(0,a,0,"up")}function _(e,a,l){var s=parseInt(l[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<l.length-s?t.selection.setAtStart(l[e.row+s][e.col]):$(0,a,0,"down")}function I(){X&&(X.find("div").css("opacity",0),X.css("top",0),X.css("left",0),X.css("height",0),X.find("div").css("height",0),X.hide())}function T(){U&&U.removeClass("fr-visible").css("left","-9999px")}function N(a,l){var s=e(l),n=s.closest("table"),r=n.parent();if(l&&"TD"!=l.tagName&&"TH"!=l.tagName&&(0<s.closest("td").length?l=s.closest("td"):0<s.closest("th").length&&(l=s.closest("th"))),!l||"TD"!=l.tagName&&"TH"!=l.tagName)X&&s.get(0)!=X.get(0)&&s.parent().get(0)!=X.get(0)&&t.core.sameInstance(X)&&I();else{if(s=e(l),0===t.$el.find(s).length)return!1;var o=s.offset().left-1,i=o+s.outerWidth();if(Math.abs(a.pageX-o)<=t.opts.tableResizerOffset||Math.abs(i-a.pageX)<=t.opts.tableResizerOffset){var f,c,d,p,h,u=b(n),v=g(l,u),w=m(v.row,v.col,u),C=n.offset().top,R=n.outerHeight()-1;"rtl"!=t.opts.direction?a.pageX-o<=t.opts.tableResizerOffset?(d=o,0<v.col?(p=o-k(v.col-1,u)+t.opts.tableResizingLimit,h=o+k(v.col,u)-t.opts.tableResizingLimit,f=v.col-1,c=v.col):(f=null,c=0,p=n.offset().left-1-parseInt(n.css("margin-left"),10),h=n.offset().left-1+n.width()-u[0].length*t.opts.tableResizingLimit)):i-a.pageX<=t.opts.tableResizerOffset&&(d=i,w.col<u[w.row].length&&u[w.row][w.col+1]?(p=i-k(w.col,u)+t.opts.tableResizingLimit,h=i+k(w.col+1,u)-t.opts.tableResizingLimit,f=w.col,c=w.col+1):(f=w.col,c=null,p=n.offset().left-1+u[0].length*t.opts.tableResizingLimit,h=r.offset().left-1+r.width()+parseFloat(r.css("padding-left")))):i-a.pageX<=t.opts.tableResizerOffset?(d=i,0<v.col?(p=i-k(v.col,u)+t.opts.tableResizingLimit,h=i+k(v.col-1,u)-t.opts.tableResizingLimit,f=v.col,c=v.col-1):(f=null,c=0,p=n.offset().left+u[0].length*t.opts.tableResizingLimit,h=r.offset().left-1+r.width()+parseFloat(r.css("padding-left")))):a.pageX-o<=t.opts.tableResizerOffset&&(d=o,w.col<u[w.row].length&&u[w.row][w.col+1]?(p=o-k(w.col+1,u)+t.opts.tableResizingLimit,h=o+k(w.col,u)-t.opts.tableResizingLimit,f=w.col+1,c=w.col):(f=w.col,c=null,p=r.offset().left+parseFloat(r.css("padding-left")),h=n.offset().left-1+n.width()-u[0].length*t.opts.tableResizingLimit)),X||(t.shared.$table_resizer||(t.shared.$table_resizer=e('<div class="fr-table-resizer"><div></div></div>')),X=t.shared.$table_resizer,t.events.$on(X,"mousedown",function(e){return!t.core.sameInstance(X)||(0<j().length&&F(),1==e.which?(t.selection.save(),Z=!0,X.addClass("fr-moving"),E(),t.edit.off(),X.find("div").css("opacity",1),!1):void 0)}),t.events.$on(X,"mousemove",function(e){if(!t.core.sameInstance(X))return!0;Z&&(t.opts.iframe&&(e.pageX-=t.$iframe.offset().left),L(e))}),t.events.on("shared.destroy",function(){X.html("").removeData().remove(),X=null},!0),t.events.on("destroy",function(){t.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),X.hide().appendTo(e("body:first"))},!0)),X.data("table",n),X.data("first",f),X.data("second",c),X.data("instance",t),t.$wp.append(X);var O=d-t.win.pageXOffset-t.opts.tableResizerOffset-t.$wp.offset().left,A=C-t.$wp.offset().top+t.$wp.scrollTop();t.opts.iframe&&(O+=t.$iframe.offset().left,A+=t.$iframe.offset().top,p+=t.$iframe.offset().left,h+=t.$iframe.offset().left),X.data("max-left",p),X.data("max-right",h),X.data("origin",d-t.win.pageXOffset),X.css("top",A),X.css("left",O),X.css("height",R),X.find("div").css("height",R),X.css("padding-left",t.opts.tableResizerOffset),X.css("padding-right",t.opts.tableResizerOffset),X.show()}else t.core.sameInstance(X)&&I()}}function S(a,l){if(t.$box.find(".fr-line-breaker").is(":visible"))return!1;U||Y(),t.$box.append(U),U.data("instance",t);var s,n=e(l).find("tr:first"),r=a.pageX,o=0,i=0;t.opts.iframe&&(o+=t.$iframe.offset().left-t.helpers.scrollLeft(),i+=t.$iframe.offset().top-t.helpers.scrollTop()),n.find("th, td").each(function(){var a=e(this);return a.offset().left<=r&&r<a.offset().left+a.outerWidth()/2?(s=parseInt(U.find("a").css("width"),10),U.css("top",i+a.offset().top-t.$box.offset().top-t.win.pageYOffset-s-5),U.css("left",o+a.offset().left-t.$box.offset().left-t.win.pageXOffset-s/2),U.data("selected-cell",a),U.data("position","before"),U.addClass("fr-visible"),!1):a.offset().left+a.outerWidth()/2<=r&&r<a.offset().left+a.outerWidth()?(s=parseInt(U.find("a").css("width"),10),U.css("top",i+a.offset().top-t.$box.offset().top-t.win.pageYOffset-s-5),U.css("left",o+a.offset().left-t.$box.offset().left+a.outerWidth()-t.win.pageXOffset-s/2),U.data("selected-cell",a),U.data("position","after"),U.addClass("fr-visible"),!1):void 0})}function z(a,l){if(t.$box.find(".fr-line-breaker").is(":visible"))return!1;U||Y(),t.$box.append(U),U.data("instance",t);var s,n=e(l),r=a.pageY,o=0,i=0;t.opts.iframe&&(o+=t.$iframe.offset().left-t.helpers.scrollLeft(),i+=t.$iframe.offset().top-t.helpers.scrollTop()),n.find("tr").each(function(){var a=e(this);return a.offset().top<=r&&r<a.offset().top+a.outerHeight()/2?(s=parseInt(U.find("a").css("width"),10),U.css("top",i+a.offset().top-t.$box.offset().top-t.win.pageYOffset-s/2),U.css("left",o+a.offset().left-t.$box.offset().left-t.win.pageXOffset-s-5),U.data("selected-cell",a.find("td:first")),U.data("position","above"),U.addClass("fr-visible"),!1):a.offset().top+a.outerHeight()/2<=r&&r<a.offset().top+a.outerHeight()?(s=parseInt(U.find("a").css("width"),10),U.css("top",i+a.offset().top-t.$box.offset().top+a.outerHeight()-t.win.pageYOffset-s/2),U.css("left",o+a.offset().left-t.$box.offset().left-t.win.pageXOffset-s-5),U.data("selected-cell",a.find("td:first")),U.data("position","below"),U.addClass("fr-visible"),!1):void 0})}function B(a){Q=null;var l=t.doc.elementFromPoint(a.pageX-t.win.pageXOffset,a.pageY-t.win.pageYOffset);t.opts.tableResizer&&(!t.popups.areVisible()||t.popups.areVisible()&&t.popups.isVisible("table.edit"))&&N(a,l),!t.opts.tableInsertHelper||t.popups.areVisible()||t.$tb.hasClass("fr-inline")&&t.$tb.is(":visible")||function(a,l){if(0===j().length){var s,n,r;if(l&&("HTML"==l.tagName||"BODY"==l.tagName||t.node.isElement(l)))for(s=1;s<=t.opts.tableInsertHelperOffset;s++){if(n=t.doc.elementFromPoint(a.pageX-t.win.pageXOffset,a.pageY-t.win.pageYOffset+s),e(n).hasClass("fr-tooltip"))return;if(n&&("TH"==n.tagName||"TD"==n.tagName||"TABLE"==n.tagName)&&(e(n).parents(".fr-wrapper").length||t.opts.iframe))return S(a,e(n).closest("table"));if(r=t.doc.elementFromPoint(a.pageX-t.win.pageXOffset+s,a.pageY-t.win.pageYOffset),e(r).hasClass("fr-tooltip"))return;if(r&&("TH"==r.tagName||"TD"==r.tagName||"TABLE"==r.tagName)&&(e(r).parents(".fr-wrapper").length||t.opts.iframe))return z(a,e(r).closest("table"))}t.core.sameInstance(U)&&T()}}(a,l)}function W(){if(Z){var e=X.data("table").offset().top-t.win.pageYOffset;t.opts.iframe&&(e+=t.$iframe.offset().top-t.helpers.scrollTop()),X.css("top",e)}}function k(t,a){var l,s=e(a[0][t]).outerWidth();for(l=1;l<a.length;l++)s=Math.min(s,e(a[l][t]).outerWidth());return s}function K(e,t,a){var l,s=0;for(l=e;l<=t;l++)s+=k(l,a);return s}function L(e){if(1<j().length&&G&&E(),!1===G&&!1===q&&!1===Z)Q&&clearTimeout(Q),t.edit.isDisabled()&&!t.popups.isVisible("table.edit")||(Q=setTimeout(B,30,e));else if(Z){var a=e.pageX-t.win.pageXOffset;t.opts.iframe&&(a+=t.$iframe.offset().left);var l=X.data("max-left"),s=X.data("max-right");l<=a&&a<=s?X.css("left",a-t.opts.tableResizerOffset-t.$wp.offset().left):a<l&&parseFloat(X.css("left"),10)>l-t.opts.tableResizerOffset?X.css("left",l-t.opts.tableResizerOffset-t.$wp.offset().left):s<a&&parseFloat(X.css("left"),10)<s-t.opts.tableResizerOffset&&X.css("left",s-t.opts.tableResizerOffset-t.$wp.offset().left)}else G&&T()}function H(a){t.node.isEmpty(a.get(0))?a.prepend(e.FE.MARKERS):a.prepend(e.FE.START_MARKER).append(e.FE.END_MARKER)}function Y(){t.shared.$ti_helper||(t.shared.$ti_helper=e('<div class="fr-insert-helper"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+t.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>'),t.events.bindClick(t.shared.$ti_helper,"a",function(){var e=U.data("selected-cell"),a=U.data("position"),l=U.data("instance")||t;"before"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"after"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"above"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"below"==a&&(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()),T()}),t.events.on("shared.destroy",function(){t.shared.$ti_helper.html("").removeData().remove(),t.shared.$ti_helper=null},!0),t.events.$on(t.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),t.events.$on(e(t.o_win),"scroll",function(){T()},!0),t.events.$on(t.$wp,"scroll",function(){T()},!0)),U=t.shared.$ti_helper,t.events.on("destroy",function(){U=null}),t.tooltip.bind(t.$box,".fr-insert-helper > a.fr-floating-btn")}function P(){J=null,clearTimeout(Q)}function j(){return t.el.querySelectorAll(".fr-selected-cell")}function V(){var a=j();if(a.length){for(var l=a[0];l&&"TABLE"!=l.tagName&&l.parentNode!=t.el;)l=l.parentNode;return l&&"TABLE"==l.tagName?e(l):e([])}return e([])}var X,U,q,G,J,Q,Z;return{_init:function(){if(!t.$wp)return!1;if(!t.helpers.isMobile()){Z=q=G=!1,t.events.$on(t.$el,"mousedown",x),t.popups.onShow("image.edit",function(){w(),q=G=!1}),t.popups.onShow("link.edit",function(){w(),q=G=!1}),t.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&w()}),t.events.$on(t.$el,"mouseenter","th, td",y),t.events.$on(t.$win,"mouseup",D),t.opts.iframe&&t.events.$on(e(t.o_win),"mouseup",D),t.events.$on(t.$win,"mousemove",L),t.events.$on(e(t.o_win),"scroll",W),t.events.on("contentChanged",function(){0<j().length&&(a(),t.$el.find("img").on("load.selected-cells",function(){e(this).off("load.selected-cells"),0<j().length&&a()}))}),t.events.$on(e(t.o_win),"resize",function(){w()}),t.events.on("toolbar.esc",function(){if(0<j().length)return t.events.disableBlur(),t.events.focus(),!1},!0),t.events.$on(e(t.o_win),"keydown",function(){G&&q&&(q=G=!1,t.$el.removeClass("fr-no-selection"),t.edit.on(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell:last").get(0)),t.selection.restore(),w())}),t.events.$on(t.$el,"keydown",function(l){l.shiftKey?!1===function(a){var l=j();if(0<l.length){var s,n,r=b(),o=a.which;1==l.length?n=s=l[0]:(s=t.el.querySelector(".fr-cell-fixed"),n=t.el.querySelector(".fr-cell-handler"));var i=g(n,r);if(e.FE.KEYCODE.ARROW_RIGHT==o){if(i.col<r[0].length-1)return O(s,r[i.row][i.col+1]),!1}else if(e.FE.KEYCODE.ARROW_DOWN==o){if(i.row<r.length-1)return O(s,r[i.row+1][i.col]),!1}else if(e.FE.KEYCODE.ARROW_LEFT==o){if(0<i.col)return O(s,r[i.row][i.col-1]),!1}else if(e.FE.KEYCODE.ARROW_UP==o&&0<i.row)return O(s,r[i.row-1][i.col]),!1}}(l)&&setTimeout(function(){a()},0):function(a){var l=a.which,s=t.selection.blocks();if(s.length&&("TD"==(s=s[0]).tagName||"TH"==s.tagName)){for(var n=s;n&&"TABLE"!=n.tagName&&n.parentNode!=t.el;)n=n.parentNode;if(n&&"TABLE"==n.tagName&&(e.FE.KEYCODE.ARROW_LEFT==l||e.FE.KEYCODE.ARROW_UP==l||e.FE.KEYCODE.ARROW_RIGHT==l||e.FE.KEYCODE.ARROW_DOWN==l)&&(0<j().length&&F(),t.browser.webkit&&(e.FE.KEYCODE.ARROW_UP==l||e.FE.KEYCODE.ARROW_DOWN==l))){var r=t.selection.ranges(0).startContainer;if(r.nodeType==Node.TEXT_NODE&&(e.FE.KEYCODE.ARROW_UP==l&&r.previousSibling||e.FE.KEYCODE.ARROW_DOWN==l&&r.nextSibling))return;a.preventDefault(),a.stopPropagation();var o=b(e(n)),i=g(s,o);e.FE.KEYCODE.ARROW_UP==l?M(i,n,o):e.FE.KEYCODE.ARROW_DOWN==l&&_(i,n,o),t.selection.restore()}}}(l)}),t.events.on("keydown",function(l){if(!1===function(a){if(a.which==e.FE.KEYCODE.TAB){var l;if(0<j().length)l=t.$el.find(".fr-selected-cell:last");else{var s=t.selection.element();"TD"==s.tagName||"TH"==s.tagName?l=e(s):s!=t.el&&(0<e(s).parentsUntil(t.$el,"td").length?l=e(s).parents("td:first"):0<e(s).parentsUntil(t.$el,"th").length&&(l=e(s).parents("th:first")))}if(l)return a.preventDefault(),!!(0<e(t.selection.element()).parentsUntil(t.$el,"ol, ul").length&&(0<e(t.selection.element()).parents("li").prev().length||e(t.selection.element()).is("li")&&0<e(t.selection.element()).prev().length))||(F(),a.shiftKey?0<l.prev().length?H(l.prev()):0<l.closest("tr").length&&0<l.closest("tr").prev().length?H(l.closest("tr").prev().find("td:last")):0<l.closest("tbody").length&&0<l.closest("table").find("thead tr").length&&H(l.closest("table").find("thead tr th:last")):0<l.next().length?H(l.next()):0<l.closest("tr").length&&0<l.closest("tr").next().length?H(l.closest("tr").next().find("td:first")):0<l.closest("thead").length&&0<l.closest("table").find("tbody tr").length?H(l.closest("table").find("tbody tr td:first")):(l.addClass("fr-selected-cell"),f("below"),w(),H(l.closest("tr").next().find("td:first"))),t.selection.restore(),!1)}}(l))return!1;var s=j();if(0<s.length){if(0<s.length&&t.keys.ctrlKey(l)&&l.which==e.FE.KEYCODE.A)return w(),t.popups.isVisible("table.edit")&&t.popups.hide("table.edit"),s=[],!0;if(l.which==e.FE.KEYCODE.ESC&&t.popups.isVisible("table.edit"))return w(),t.popups.hide("table.edit"),l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),!(s=[]);if(1<s.length&&(l.which==e.FE.KEYCODE.BACKSPACE||l.which==e.FE.KEYCODE.DELETE)){t.undo.saveStep();for(var n=0;n<s.length;n++)e(s[n]).html("<br>"),n==s.length-1&&e(s[n]).prepend(e.FE.MARKERS);return t.selection.restore(),t.undo.saveStep(),!(s=[])}if(1<s.length&&l.which!=e.FE.KEYCODE.F10&&!t.keys.isBrowserAction(l))return l.preventDefault(),!(s=[])}else if(!(s=[])===function(l){if(l.altKey&&l.which==e.FE.KEYCODE.SPACE){var s,n=t.selection.element();if("TD"==n.tagName||"TH"==n.tagName?s=n:0<e(n).closest("td").length?s=e(n).closest("td").get(0):0<e(n).closest("th").length&&(s=e(n).closest("th").get(0)),s)return l.preventDefault(),O(s,s),a(),!1}}(l))return!1},!0);var l=[];t.events.on("html.beforeGet",function(){l=j();for(var e=0;e<l.length;e++)l[e].className=(l[e].className||"").replace(/fr-selected-cell/g,"")}),t.events.on("html.afterGet",function(){for(var e=0;e<l.length;e++)l[e].className=(l[e].className?l[e].className.trim()+" ":"")+"fr-selected-cell";l=[]}),n(!0),o(!0)}t.events.on("destroy",P)},insert:function(a,l){var s,n,r="<table "+(t.opts.tableDefaultWidth?'style="width: '+t.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',o=100/l;for(s=0;s<a;s++){for(r+="<tr>",n=0;n<l;n++)r+="<td"+(t.opts.tableDefaultWidth?' style="width: '+o.toFixed(4)+'%;"':"")+">",0===s&&0===n&&(r+=e.FE.MARKERS),r+="<br></td>";r+="</tr>"}r+="</tbody></table>",t.html.insert(r),t.selection.restore();var i=t.$el.find(".fr-inserted-table");i.removeClass("fr-inserted-table"),t.events.trigger("table.inserted",[i.get(0)])},remove:i,insertRow:f,deleteRow:function(){var a=V();if(0<a.length){var l,s,n,r=b(),o=C(r);if(0===o.min_i&&o.max_i==r.length-1)i();else{for(l=o.max_i;l>=o.min_i;l--){for(n=e(a.find("tr").not(a.find("table tr")).get(l)),s=0;s<r[l].length;s++)if(0===s||r[l][s]!=r[l][s-1]){var f=e(r[l][s]);if(1<parseInt(f.attr("rowspan"),10)){var c=parseInt(f.attr("rowspan"),10)-1;1==c?f.removeAttr("rowspan"):f.attr("rowspan",c)}if(l<r.length-1&&r[l][s]==r[l+1][s]&&(0===l||r[l][s]!=r[l-1][s])){for(var d=r[l][s],p=s;0<p&&r[l][p]==r[l][p-1];)p--
;0===p?e(a.find("tr").not(a.find("table tr")).get(l+1)).prepend(d):e(r[l+1][p-1]).after(d)}}var u=n.parent();n.remove(),0===u.find("tr").length&&u.remove(),r=b(a)}h(0,r.length-1,0,r[0].length-1,a),0<o.min_i?t.selection.setAtEnd(r[o.min_i-1][0]):t.selection.setAtEnd(r[0][0]),t.selection.restore(),t.popups.hide("table.edit")}}},insertColumn:function(l){var s=V();if(0<s.length){var n,r=b(),o=C(r);n="before"==l?o.min_j:o.max_j;var i,f=100/r[0].length,c=100/(r[0].length+1);s.find("th, td").each(function(){(i=e(this)).data("old-width",i.outerWidth()/s.outerWidth()*100)}),s.find("tr").not(s.find("table tr")).each(function(t){for(var a,s=e(this),o=0,i=0;o-1<n;){if(!(a=s.find("> th, > td").get(i))){a=null;break}a==r[t][o]?(o+=parseInt(e(a).attr("colspan"),10)||1,i++):(o+=parseInt(e(r[t][o]).attr("colspan"),10)||1,"after"==l&&(a=0===i?-1:s.find("> th, > td").get(i-1)))}var d,p=e(a);if("after"==l&&n<o-1||"before"==l&&0<n&&r[t][n]==r[t][n-1]){if(0===t||0<t&&r[t][n]!=r[t-1][n]){var h=parseInt(p.attr("colspan"),10)+1;p.attr("colspan",h),p.css("width",(p.data("old-width")*c/f+c).toFixed(4)+"%"),p.removeData("old-width")}}else d=0<s.find("th").length?'<th style="width: '+c.toFixed(4)+'%;"><br></th>':'<td style="width: '+c.toFixed(4)+'%;"><br></td>',-1==a?s.prepend(d):null==a?s.append(d):"before"==l?p.before(d):"after"==l&&p.after(d)}),s.find("th, td").each(function(){(i=e(this)).data("old-width")&&(i.css("width",(i.data("old-width")*c/f).toFixed(4)+"%"),i.removeData("old-width"))}),t.popups.isVisible("table.edit")&&a()}},deleteColumn:function(){var a=V();if(0<a.length){var l,s,n,r=b(),o=C(r);if(0===o.min_j&&o.max_j==r[0].length-1)i();else{var f=0;for(l=0;l<r.length;l++)for(s=0;s<r[0].length;s++)(n=e(r[l][s])).hasClass("fr-selected-cell")||(n.data("old-width",n.outerWidth()/a.outerWidth()*100),(s<o.min_j||s>o.max_j)&&(f+=n.outerWidth()/a.outerWidth()*100));for(f/=r.length,s=o.max_j;s>=o.min_j;s--)for(l=0;l<r.length;l++)if(0===l||r[l][s]!=r[l-1][s])if(n=e(r[l][s]),1<(parseInt(n.attr("colspan"),10)||1)){var c=parseInt(n.attr("colspan"),10)-1;1==c?n.removeAttr("colspan"):n.attr("colspan",c),n.css("width",(100*(n.data("old-width")-k(s,r))/f).toFixed(4)+"%"),n.removeData("old-width")}else{var d=e(n.parent().get(0));n.remove(),0===d.find("> th, > td").length&&(0===d.prev().length||0===d.next().length||d.prev().find("> th[rowspan], > td[rowspan]").length<d.prev().find("> th, > td").length)&&d.remove()}h(0,r.length-1,0,r[0].length-1,a),0<o.min_j?t.selection.setAtEnd(r[o.min_i][o.min_j-1]):t.selection.setAtEnd(r[o.min_i][0]),t.selection.restore(),t.popups.hide("table.edit"),a.find("th, td").each(function(){(n=e(this)).data("old-width")&&(n.css("width",(100*n.data("old-width")/f).toFixed(4)+"%"),n.removeData("old-width"))})}}},mergeCells:function(){if(1<j().length&&(0===t.$el.find("th.fr-selected-cell").length||0===t.$el.find("td.fr-selected-cell").length)){v();var l,s,n=C(b()),r=t.$el.find(".fr-selected-cell"),o=e(r[0]),i=o.parent().find(".fr-selected-cell"),f=o.closest("table"),p=o.html(),h=0;for(l=0;l<i.length;l++)h+=e(i[l]).outerWidth();for(o.css("width",Math.min(100,h/f.outerWidth()*100).toFixed(4)+"%"),n.min_j<n.max_j&&o.attr("colspan",n.max_j-n.min_j+1),n.min_i<n.max_i&&o.attr("rowspan",n.max_i-n.min_i+1),l=1;l<r.length;l++)"<br>"!=(s=e(r[l])).html()&&""!==s.html()&&(p+="<br>"+s.html()),s.remove();o.html(p),t.selection.setAtEnd(o.get(0)),t.selection.restore(),t.toolbar.enable(),d(n.min_i,n.max_i,f);var u=f.find("tr:empty");for(l=u.length-1;0<=l;l--)e(u[l]).remove();c(n.min_j,n.max_j,f),a()}},splitCellVertically:function(){if(1==j().length){var a=t.$el.find(".fr-selected-cell"),l=parseInt(a.attr("colspan"),10)||1,s=a.parent().outerWidth(),n=a.outerWidth(),r=a.clone().html("<br>"),o=b(),i=g(a.get(0),o);if(1<l){var f=Math.ceil(l/2);n=K(i.col,i.col+f-1,o)/s*100;var c=K(i.col+f,i.col+l-1,o)/s*100;1<f?a.attr("colspan",f):a.removeAttr("colspan"),1<l-f?r.attr("colspan",l-f):r.removeAttr("colspan"),a.css("width",n.toFixed(4)+"%"),r.css("width",c.toFixed(4)+"%")}else{var d;for(d=0;d<o.length;d++)if(0===d||o[d][i.col]!=o[d-1][i.col]){var p=e(o[d][i.col]);if(!p.is(a)){var h=(parseInt(p.attr("colspan"),10)||1)+1;p.attr("colspan",h)}}n=n/s*100/2,a.css("width",n.toFixed(4)+"%"),r.css("width",n.toFixed(4)+"%")}a.after(r),w(),t.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==j().length){var a=t.$el.find(".fr-selected-cell"),l=a.parent(),s=a.closest("table"),n=parseInt(a.attr("rowspan"),10),r=b(),o=g(a.get(0),r),i=a.clone().html("<br>");if(1<n){var f=Math.ceil(n/2);1<f?a.attr("rowspan",f):a.removeAttr("rowspan"),1<n-f?i.attr("rowspan",n-f):i.removeAttr("rowspan");for(var c=o.row+f,d=0===o.col?o.col:o.col-1;0<=d&&(r[c][d]==r[c][d-1]||0<c&&r[c][d]==r[c-1][d]);)d--;-1==d?e(s.find("tr").not(s.find("table tr")).get(c)).prepend(i):e(r[c][d]).after(i)}else{var p,h=e("<tr>").append(i);for(p=0;p<r[0].length;p++)if(0===p||r[o.row][p]!=r[o.row][p-1]){var u=e(r[o.row][p]);u.is(a)||u.attr("rowspan",(parseInt(u.attr("rowspan"),10)||1)+1)}l.after(h)}w(),t.popups.hide("table.edit")}},addHeader:function(){var t=V();if(0<t.length&&0===t.find("th").length){var l,s="<thead><tr>",n=0;for(t.find("tr:first > td").each(function(){var t=e(this);n+=parseInt(t.attr("colspan"),10)||1}),l=0;l<n;l++)s+="<th><br></th>";s+="</tr></thead>",t.prepend(s),a()}},removeHeader:function(){var e=V(),l=e.find("thead");if(0<l.length)if(0===e.find("tbody tr").length)i();else if(l.remove(),0<j().length)a();else{t.popups.hide("table.edit");var s=e.find("tbody tr:first td:first").get(0);s&&(t.selection.setAtEnd(s),t.selection.restore())}},setBackground:u,showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertTable"]'),a=t.popups.get("table.insert");if(a||(a=n()),!a.hasClass("fr-active")){t.popups.refresh("table.insert"),t.popups.setContainer("table.insert",t.$tb);var l=e.offset().left+e.outerWidth()/2,s=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("table.insert",l,s,e.outerHeight())}},showEditPopup:a,showColorsPopup:l,back:function(){0<j().length?a():(t.popups.hide("table.insert"),t.toolbar.showInline())},verticalAlign:function(e){t.$el.find(".fr-selected-cell").css("vertical-align",e)},horizontalAlign:function(e){t.$el.find(".fr-selected-cell").css("text-align",e)},applyStyle:function(e,t,a,l){if(0<t.length){if(!a){var s=Object.keys(l);s.splice(s.indexOf(e),1),t.removeClass(s.join(" "))}t.toggleClass(e)}},selectedTable:V,selectedCells:j,customColor:function(){var e=t.popups.get("table.colors").find(".fr-table-colors-hex-layer input");e.length&&u(e.val())},selectCells:O}},e.FE.DefineIcon("insertTable",{NAME:"table"}),e.FE.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),e.FE.RegisterCommand("tableInsert",{callback:function(e,t,a){this.table.insert(t,a),this.popups.hide("table.insert")}}),e.FE.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading"}),e.FE.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();0<t.length&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),e.FE.DefineIcon("tableRows",{NAME:"bars"}),e.FE.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below","delete":"Delete row"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableRows.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+"</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),e.FE.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90"}),e.FE.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after","delete":"Delete column"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableColumns.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+"</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),e.FE.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square"}),e.FE.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCells.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+"</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){1<this.$el.find(".fr-selected-cell").length?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),e.FE.DefineIcon("tableRemove",{NAME:"trash"}),e.FE.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),e.FE.DefineIcon("tableStyle",{NAME:"paint-brush"}),e.FE.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(t,a){var l=this.$el.find(".fr-selected-cell").closest("table");l&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=l.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.DefineIcon("tableCellBackground",{NAME:"tint"}),e.FE.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),e.FE.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),e.FE.DefineIcon("tableBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v"}),e.FE.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCellVerticalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+l.toLowerCase()+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(l)+"</a></li>");return t+"</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.FE.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left"}),e.FE.DefineIcon("align-left",{NAME:"align-left"}),e.FE.DefineIcon("align-right",{NAME:"align-right"}),e.FE.DefineIcon("align-center",{NAME:"align-center"}),e.FE.DefineIcon("align-justify",{NAME:"align-justify"}),e.FE.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.tableCellHorizontalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.icon.create("align-"+l)+'<span class="fr-sr-only">'+this.language.translate(a[l])+"</span></a></li>");return t+"</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(t){var a=this.table.selectedCells();a.length&&t.find("> *:first").replaceWith(this.icon.create("align-"+this.helpers.getAlignment(e(a[0]))))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell:first"))+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.FE.DefineIcon("tableCellStyle",{NAME:"magic"}),e.FE.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(t,a){var l=this.$el.find(".fr-selected-cell:first");l&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=l.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),e.FE.DefineIcon("tableColorRemove",{NAME:"eraser"})});